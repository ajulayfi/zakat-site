<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Ø²ÙƒØ§Ø© Ø§Ù„ÙØ·Ø± 1446</title>

<style>
:root{
  --primary:#0B3B2E;
  --primary2:#0F5132;
  --bg:#EEF2F4;
  --card:#FFFFFF;
  --text:#111827;
  --muted:#6B7280;
  --border:#E5E7EB;
  --focus:rgba(15,81,50,.16);
  --shadow:0 14px 38px rgba(0,0,0,.08);
  --radius:18px;

  --success-bg:#DCFCE7;
  --success-tx:#166534;
  --error-bg:#FEE2E2;
  --error-tx:#991B1B;
}

*{box-sizing:border-box;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Tahoma}
body{
  margin:0;
  background:linear-gradient(180deg,#F7F9FB,var(--bg));
  min-height:100vh;
  display:flex;
  justify-content:center;
  padding:18px;
  color:var(--text);
}
.container{width:100%;max-width:450px}

/* Top header like banking apps */
.topbar{
  background:linear-gradient(180deg,var(--primary2),var(--primary));
  color:#fff;
  padding:16px;
  border-radius:20px;
  box-shadow:var(--shadow);
  margin-bottom:12px;
}
.topbar .row{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
}
.title{
  margin:0;
  font-size:18px;
  font-weight:900;
}
.pill{
  padding:7px 11px;
  border-radius:999px;
  font-size:12px;
  background:rgba(255,255,255,.14);
  border:1px solid rgba(255,255,255,.18);
  white-space:nowrap;
}
.sub{
  margin:8px 0 0;
  font-size:12.5px;
  opacity:.92;
}

/* Progress with steps */
.progress-wrap{
  margin-top:12px;
  display:flex;
  align-items:center;
  gap:10px;
}
.step-chip{
  width:28px;height:28px;
  border-radius:999px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:900;
  font-size:13px;
  background:rgba(255,255,255,.18);
  border:1px solid rgba(255,255,255,.22);
}
.step-chip.active{
  background:#22C55E;
  border-color:#22C55E;
  color:#05301F;
}
.progress{
  flex:1;
  height:8px;
  background:rgba(255,255,255,.18);
  border-radius:999px;
  overflow:hidden;
}
.bar{
  height:100%;
  width:50%;
  background:linear-gradient(90deg,#22C55E,#86EFAC);
  transition:.35s;
}

/* Card */
.card{
  background:var(--card);
  border-radius:20px;
  box-shadow:var(--shadow);
  overflow:hidden;
}

/* Section content */
.content{
  padding:16px;
}
.step{
  display:none;
  animation:fade .18s ease-out;
}
.step.active{display:block}
@keyframes fade{from{opacity:.6;transform:translateY(4px)}to{opacity:1;transform:translateY(0)}}

.head{
  display:flex;
  align-items:flex-end;
  justify-content:space-between;
  gap:10px;
  margin-bottom:12px;
}
.head h3{
  margin:0;
  font-size:14px;
  font-weight:900;
  color:var(--primary);
}
.head p{
  margin:0;
  font-size:12px;
  color:var(--muted);
}

/* Inputs */
.grid{display:grid;gap:10px}
.two{grid-template-columns:1fr 1fr}
@media (max-width:430px){ .two{grid-template-columns:1fr} }

.field{display:flex;flex-direction:column;gap:6px}
label{
  font-size:12px;
  color:var(--muted);
  font-weight:700;
}
input{
  width:100%;
  padding:15px 12px;
  border-radius:14px;
  border:1px solid var(--border);
  background:#fff;
  font-size:15px;
  transition:.15s;
}
input:focus{
  outline:none;
  border-color:rgba(15,81,50,.55);
  box-shadow:0 0 0 3px var(--focus);
}
input[readonly]{
  background:#F7F7F8;
  font-weight:900;
}

.hint{
  font-size:11.5px;
  color:var(--muted);
}

/* Upload */
.upload{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  border:1px dashed rgba(15,81,50,.40);
  background:#F6FFFA;
  padding:14px 12px;
  border-radius:14px;
  cursor:pointer;
  user-select:none;
}
.upload strong{font-size:13px;color:var(--primary2);font-weight:900}
.upload span{
  font-size:12px;color:var(--muted);
  max-width:180px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap;
}
.upload input{display:none}

/* Actions */
.actions{
  padding:14px 16px 16px;
  border-top:1px solid #F1F5F9;
}
.btnrow{display:flex;gap:10px}
.btn{
  width:100%;
  padding:16px;
  border:none;
  border-radius:16px;
  cursor:pointer;
  font-size:15px;
  font-weight:900;
  transition:.18s;
  display:flex;align-items:center;justify-content:center;gap:10px;
}
.btn.primary{
  background:linear-gradient(180deg,var(--primary2),var(--primary));
  color:#fff;
  box-shadow:0 10px 25px rgba(15,81,50,.25);
}
.btn.primary:active{transform:scale(.985)}
.btn.secondary{
  background:#F3F4F6;
  color:#111827;
  border:1px solid var(--border);
}
.btn.secondary:active{transform:scale(.985)}
.btn:disabled{opacity:.65;cursor:not-allowed;transform:none}

.spinner{
  width:16px;height:16px;border-radius:50%;
  border:2px solid rgba(255,255,255,.35);
  border-top-color:#fff;
  display:none;
  animation:spin .8s linear infinite;
}
@keyframes spin{to{transform:rotate(360deg)}}

#message{
  margin-top:10px;
  padding:12px;
  border-radius:14px;
  display:none;
  text-align:center;
  font-size:13px;
}
#message.success{background:var(--success-bg);color:var(--success-tx)}
#message.error{background:var(--error-bg);color:var(--error-tx)}

.footer{
  text-align:center;
  font-size:12px;
  color:var(--muted);
  margin-top:12px;
}
</style>
</head>

<body>
<div class="container">

  <div class="topbar">
    <div class="row">
      <h1 class="title">Ø²ÙƒØ§Ø© Ø§Ù„ÙØ·Ø± 1446</h1>
      <div class="pill">25 Ø±ÙŠØ§Ù„ / ÙØ±Ø¯</div>
    </div>
    <p class="sub">ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ¥Ø±ÙØ§Ù‚ Ø¥ÙŠØµØ§Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„</p>

    <div class="progress-wrap">
      <div class="step-chip active" id="chip1">1</div>
      <div class="progress"><div class="bar" id="bar"></div></div>
      <div class="step-chip" id="chip2">2</div>
    </div>
  </div>

  <div class="card">
    <div class="content">

      <!-- STEP 1 -->
      <div class="step active" id="step1">
        <div class="head">
          <h3>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªÙÙŠØ¯</h3>
          <p>Ø£Ø¯Ø®Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</p>
        </div>

        <div class="grid two">
          <div class="field">
            <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„</label>
            <input id="firstName" type="text" placeholder="Ù…Ø«Ø§Ù„: Ù…Ø­Ù…Ø¯" autocomplete="name">
          </div>
          <div class="field">
            <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ø§Ù†ÙŠ</label>
            <input id="secondName" type="text" placeholder="Ù…Ø«Ø§Ù„: Ø£Ø­Ù…Ø¯">
          </div>
        </div>

        <div class="grid two" style="margin-top:10px">
          <div class="field">
            <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø«Ø§Ù„Ø«</label>
            <input id="thirdName" type="text" placeholder="Ù…Ø«Ø§Ù„: Ø¹Ø¨Ø¯Ø§Ù„Ù„Ù‡">
          </div>
          <div class="field">
            <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø±Ø§Ø¨Ø¹</label>
            <input id="fourthName" type="text" placeholder="Ù…Ø«Ø§Ù„: Ø³Ø§Ù„Ù…">
          </div>
        </div>

        <div class="field" style="margin-top:10px">
          <label>Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ø¦Ù„Ø© (Ø«Ø§Ø¨Øª)</label>
          <input type="text" value="Ø§Ù„Ø¯ÙˆØ³Ø±ÙŠ" readonly>
        </div>

        <div class="field" style="margin-top:10px">
          <label>Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„</label>
          <input id="phone" type="tel" inputmode="numeric" placeholder="05xxxxxxxx Ø£Ùˆ +9665xxxxxxxx" autocomplete="tel">
          <div class="hint">ÙŠÙÙ‚Ø¨Ù„: 05â€¦ / 5â€¦ / 9665â€¦ / +9665â€¦</div>
        </div>
      </div>

      <!-- STEP 2 -->
      <div class="step" id="step2">
        <div class="head">
          <h3>Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø²ÙƒØ§Ø©</h3>
          <p>Ø£Ø¯Ø®Ù„ Ø§Ù„Ù…Ø¨Ø§Ù„Øº ÙˆØ¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ­ÙˆÙŠÙ„</p>
        </div>

        <div class="grid two">
          <div class="field">
            <label>Ø¹Ø¯Ø¯ Ø§Ù„Ø£ÙØ±Ø§Ø¯</label>
            <input id="people" type="number" min="1" placeholder="Ù…Ø«Ø§Ù„: 5" oninput="calcTotal()">
          </div>
          <div class="field">
            <label>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</label>
            <input id="total" type="text" placeholder="ÙŠÙØ­Ø³Ø¨ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§" readonly>
          </div>
        </div>

        <div class="grid two" style="margin-top:10px">
          <div class="field">
            <label>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹</label>
            <input id="paid" type="number" min="0" placeholder="ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† Ø£Ø¹Ù„Ù‰ Ù…Ù† Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ">
          </div>
          <div class="field">
            <label>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ­ÙˆÙŠÙ„</label>
            <input id="transferDate" type="date">
          </div>
        </div>

        <div class="field" style="margin-top:10px">
          <label>Ø§Ø³Ù… Ø§Ù„Ø¨Ù†Ùƒ Ø§Ù„Ù…Ø­ÙˆÙ„ Ù…Ù†Ù‡</label>
          <input id="bank" type="text" placeholder="Ù…Ø«Ø§Ù„: Ø§Ù„Ø±Ø§Ø¬Ø­ÙŠ">
        </div>

        <label class="upload" for="receipt" style="margin-top:10px">
          <div>
            <strong>ğŸ“ Ø¥Ø±ÙØ§Ù‚ Ø¥ÙŠØµØ§Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„</strong>
            <div class="hint" style="margin-top:4px">ØµÙˆØ±Ø© ÙˆØ§Ø­Ø¯Ø© ÙˆØ§Ø¶Ø­Ø©</div>
          </div>
          <span id="fileName">Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù</span>
          <input id="receipt" type="file" accept="image/*">
        </label>

        <div id="message"></div>
      </div>

    </div>

    <div class="actions">
      <div class="btnrow">
        <button class="btn secondary" id="backBtn" onclick="prevStep()" style="display:none">Ø±Ø¬ÙˆØ¹</button>
        <button class="btn primary" id="nextBtn" onclick="nextStep()">Ø§Ù„ØªØ§Ù„ÙŠ</button>
        <button class="btn primary" id="submitBtn" onclick="submitForm()" style="display:none">
          <span class="spinner" id="spinner"></span>
          <span id="btnText">Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨</span>
        </button>
      </div>
    </div>
  </div>

  <div class="footer">ØªÙ… Ø§Ù„ØªØ·ÙˆÙŠØ± Ù„Ø®Ø¯Ù…Ø© Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø²ÙƒØ§Ø© Ø§Ù„ÙØ·Ø±</div>

</div>

<script>
const WEB_APP_URL = "https://script.google.com/macros/s/AKfycbwQP0FiCNR73ff4dZgJWFWSU9CknFDmUCE1wLxxZObw3DruqVFB9yUfJ4pKFU5jFvJEFw/exec";
const price = 25;

const $ = (id)=>document.getElementById(id);

function calcTotal(){
  const n = parseInt($("people").value || "0", 10);
  $("total").value = n > 0 ? (n * price) : "";
}

function normalizePhone(input){
  let p = (input || "").trim();
  p = p.replace(/\s+/g,"").replace(/-/g,"");
  if(p.startsWith("+966")) p = "966" + p.slice(4);
  if(/^05\d{8}$/.test(p))   return "966" + p.slice(1);
  if(/^5\d{8}$/.test(p))    return "966" + p;
  if(/^9665\d{8}$/.test(p)) return p;
  return null;
}

function showMessage(text,type){
  const el = $("message");
  el.className = type;
  el.textContent = text;
  el.style.display = "block";
}

function setLoading(v){
  $("submitBtn").disabled = v;
  $("spinner").style.display = v ? "inline-block" : "none";
  $("btnText").textContent = v ? "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„..." : "Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨";
}

function setStep(step){
  const isStep1 = step === 1;

  $("step1").classList.toggle("active", isStep1);
  $("step2").classList.toggle("active", !isStep1);

  $("backBtn").style.display = isStep1 ? "none" : "inline-flex";
  $("nextBtn").style.display = isStep1 ? "inline-flex" : "none";
  $("submitBtn").style.display = isStep1 ? "none" : "inline-flex";

  $("chip1").classList.toggle("active", isStep1);
  $("chip2").classList.toggle("active", !isStep1);
  $("bar").style.width = isStep1 ? "50%" : "100%";

  if(isStep1) $("firstName").focus();
  else $("people").focus();
}

function validateStep1(){
  const phoneNorm = normalizePhone($("phone").value);
  if(!phoneNorm){
    showMessage("Ø±Ù‚Ù… Ø§Ù„Ø¬ÙˆØ§Ù„ ØºÙŠØ± ØµØ­ÙŠØ­", "error");
    return false;
  }
  // Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„ Ù…Ø·Ù„ÙˆØ¨ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ ØªÙØ±Ø¶ Ø§Ù„Ø«Ø§Ù†ÙŠ/Ø§Ù„Ø«Ø§Ù„Ø«)
  if(!($("firstName").value || "").trim()){
    showMessage("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„", "error");
    return false;
  }
  $("message").style.display = "none";
  return true;
}

function nextStep(){
  if(!validateStep1()) return;
  setStep(2);
}

function prevStep(){
  $("message").style.display = "none";
  setStep(1);
}

function clearForm(){
  $("firstName").value="";
  $("secondName").value="";
  $("thirdName").value="";
  $("fourthName").value="";
  $("phone").value="";
  $("people").value="";
  $("total").value="";
  $("paid").value="";
  $("transferDate").value="";
  $("bank").value="";
  $("receipt").value="";
  $("fileName").textContent="Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù";
  $("message").style.display="none";
  setStep(1);
}

document.addEventListener("DOMContentLoaded", ()=>{
  // Ø­Ø¯ Ø£Ù‚ØµÙ‰ Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„ÙŠÙˆÙ…
  const today = new Date().toISOString().split("T")[0];
  $("transferDate").setAttribute("max", today);

  $("receipt").addEventListener("change", ()=>{
    const f = $("receipt").files && $("receipt").files[0];
    $("fileName").textContent = f ? f.name : "Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù";
  });

  setStep(1);
});

async function submitForm(){
  // ØªØ­Ù‚Ù‚ Ø®Ø·ÙˆØ© 1 Ø£ÙŠØ¶Ø§Ù‹ (Ù„Ø¶Ù…Ø§Ù†)
  if(!validateStep1()) { setStep(1); return; }

  const total = parseFloat($("total").value || "0");
  const paid  = parseFloat($("paid").value || "0");
  if(total > 0 && paid < total){
    showMessage("Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹ Ø£Ù‚Ù„ Ù…Ù† Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ", "error");
    return;
  }
  if(!$("transferDate").value){
    showMessage("ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ­ÙˆÙŠÙ„", "error");
    return;
  }

  const file = $("receipt").files && $("receipt").files[0];
  if(!file){
    showMessage("ÙŠØ±Ø¬Ù‰ Ø¥Ø±ÙØ§Ù‚ Ø¥ÙŠØµØ§Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„", "error");
    return;
  }

  setLoading(true);

  const base64 = await new Promise((resolve, reject)=>{
    const r = new FileReader();
    r.onloadend = ()=> resolve(String(r.result).split(",")[1]);
    r.onerror = reject;
    r.readAsDataURL(file);
  });

  const phoneNorm = normalizePhone($("phone").value);

  const formData = new URLSearchParams();
  formData.append("first", $("firstName").value);
  formData.append("second", $("secondName").value);
  formData.append("third", $("thirdName").value);
  formData.append("fourth", $("fourthName").value);
  formData.append("phone", phoneNorm);
  formData.append("people", $("people").value);
  formData.append("total", $("total").value);
  formData.append("paid", $("paid").value);
  formData.append("transferDate", $("transferDate").value);
  formData.append("bank", $("bank").value);
  formData.append("image", base64);
  formData.append("mimeType", file.type || "image/jpeg");

  try{
    const res = await fetch(WEB_APP_URL, { method:"POST", body: formData });
    const result = (await res.text()).trim();

    if(result === "success"){
      showMessage("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø·Ù„Ø¨ Ø¨Ù†Ø¬Ø§Ø­", "success");
      setTimeout(clearForm, 900);
    }else if(result === "duplicate"){
      showMessage("Ù‡Ø°Ø§ Ø§Ù„Ø±Ù‚Ù… Ù…Ø³Ø¬Ù„ Ù…Ø³Ø¨Ù‚Ù‹Ø§", "error");
    }else{
      showMessage("Ø­Ø¯Ø« Ø®Ø·Ø£: " + result, "error");
    }
  }catch(e){
    showMessage("ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø§Ø¯Ù…", "error");
  }finally{
    setLoading(false);
  }
}
</script>
</body>
</html>